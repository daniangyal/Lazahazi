<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accelerometer Data</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js" type="text/javascript"></script>
  <script src="demo.js" type="text/javascript"></script>
</head>
<body>
  <input type="text" id="x-axis" placeholder="X-Axis">
  <input type="text" id="y-axis" placeholder="Y-Axis">
  <input type="text" id="z-axis" placeholder="Z-Axis">
  <button id="request">Request Permission</button>
  <button id="Switch">Game Start/Stop</button>

  <script>
connected=false;
document.getElementById('Switch').addEventListener('click', function() {
  // if(connected)
    // publishSwitch('Switch');
});


  document.getElementById('request').addEventListener('click', function() {
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission()
        .then(permissionState => {
          if (permissionState === 'granted') {
            addDeviceMotionListener();
          } else {
            alert('Permission denied for accessing accelerometer data.');
            addDeviceMotionListener();

          }
        })
        .catch(console.error);
    } else {
      alert('Accelerometer data permission not required on this device.');
      addDeviceMotionListener();

    }
  });

  function addDeviceMotionListener() {
  if (window.DeviceMotionEvent) {
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
      // iOS 13+
      if (DeviceMotionEvent.requestPermission() === 'granted') {
        StartConnect();
        startDeviceMotionListener();
        connected=true;
      } else {
        startDeviceMotionListener();
        StartConnect();
        connected=true;
        alert('Bekapcsolva...');
      }
    } else {
      // For non-iOS devices and iOS 12 and below
      StartConnect();
      connected=true;
      startDeviceMotionListener();
    }
  } else {
    alert('Your device or browser does not support the DeviceMotionEvent API.');
  }
}

function startDeviceMotionListener() {
  window.addEventListener('devicemotion', function(event) {
    if (event.acceleration) {
      const x = event.acceleration.x;
      const y = event.acceleration.y;
      const z = event.acceleration.z;

      // Update text boxes (optional)
      document.getElementById('x-axis').value = x;
      document.getElementById('y-axis').value = y;
      document.getElementById('z-axis').value = z;

      // Send data to MQTT client
      publishMessage('{"x": '+x+',"y": '+ y+',"z": '+ z+'}');
    } else {
      alert('Acceleration data is not available on your device or browser.');
    }
  });
}

  </script>
</body>
</html>
